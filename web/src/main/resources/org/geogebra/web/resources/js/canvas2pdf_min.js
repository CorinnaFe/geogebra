/*
 *
 *  A canvas to PDF converter. Uses a mock canvas context to build a PDF document.
 *
 *  Licensed under the MIT license:
 *  http://www.opensource.org/licenses/mit-license.php
 *
 *  Author:
 *  Joshua Gould
 *
 *  @license Copyright (c) 2017 Joshua Gould
 */
!function(t){"use strict";var f=void 0!==f?f:{};function r(t,e,o,i){t=t%360+360*(t<0);var n=o+(o<.5?o:1-o)*(e=isNaN(t)||isNaN(e)?0:e),r=2*o-n;return a(s(240<=t?t-240:t+120,r,n),s(t,r,n),s(t<120?t+240:t-120,r,n),i)}function s(t,e,o){return 255*(t<60?e+(o-e)*t/60:t<180?o:t<240?e+(o-e)*(240-t)/60:e)}"undefined"!=typeof module&&module.exports?module.exports=f:"function"==typeof define&&define.amd?define(function(){return f}):t.canvas2pdf=f;function a(t,e,o,i){return{c:t/255+" "+e/255+" "+o/255,a:i}}function h(t){if(!t)return{c:"0 0 0",a:1};function e(t,e){return t.substring(0,e.length)===e}var o;if(!e(t,"rgb")&&!e(t,"hsl")){var i=document.createElement("div");i.style.color=t,document.body.appendChild(i),t=window.getComputedStyle(i).color+"",document.body.removeChild(i)}var n=((t=t.replace(/\s/g,""))+"").trim().toLowerCase();return(o=c.exec(n))?a(o[1],o[2],o[3],1):(o=m.exec(n))?a(255*o[1]/100,255*o[2]/100,255*o[3]/100,1):(o=y.exec(n))?a(o[1],o[2],o[3],o[4]):(o=C.exec(n))?a(255*o[1]/100,255*o[2]/100,255*o[3]/100,o[4]):(o=P.exec(n))?r(o[1],o[2]/100,o[3]/100):(o=x.exec(n))?r(o[1],o[2]/100,o[3]/100,o[4]):{c:t,a:1}}var p,d,l,u,g,e="\\s*([+-]?\\d+)\\s*",o="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",i="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",c=new RegExp("^rgb\\("+[e,e,e]+"\\)$"),m=new RegExp("^rgb\\("+[i,i,i]+"\\)$"),y=new RegExp("^rgba\\("+[e,e,e,o]+"\\)$"),C=new RegExp("^rgba\\("+[i,i,i,o]+"\\)$"),P=new RegExp("^hsl\\("+[o,i,i]+"\\)$"),x=new RegExp("^hsla\\("+[o,i,i,o]+"\\)$");
/*
	@license MIT LICENSE
	Copyright (c) 2014 Devon Govett

	Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

	The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

	THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
	*/
function v(){this.objects=[],this.catalog=this.add(new n),this.pages=this.add(new T),this.catalog.setPages(this.pages),this.pageWidth=8.27,this.pageHeight=11.69,this.textStyle=new F,this.fonts=[],this.lineWidth=1,this.lineEndType=0,this.alpha=1,f.usePako=!1}function n(){}function T(){this.pages=[]}function S(t,e,o,i){this.pdf=t,this.fonts=[],this.images=[],this.fillImages=[],this.alphas=[],this.fillColor="0 0 0 ",this.strokeColor="0 0 0 ",this.lineWidth=2,this.lineCap=0,this.lineJoin=1,this.fontSize=12,this.font="normal",this.width=72*e,this.height=72*o,this.pagesID=i,this._ctm=[1,0,0,1,0,0]}function b(t){this.fontName=t}function w(){this.stream=""}function I(t){this.width=t.width,this.height=t.height;for(var e=t.getContext("2d"),o=new Uint8Array(this.height*this.width*3),i=e.getImageData(0,0,this.width,this.height),n=0,r=0;r<this.height;r++)for(var s=0;s<this.width;s++){var a=i.data[4*(s+r*this.width)],h=i.data[4*(s+r*this.width)+1],c=i.data[4*(s+r*this.width)+2];o[n++]=a,o[n++]=h,o[n++]=c}f.usePako&&(o=pako.deflate(o));var p=[];for(n=0;n<o.length;n++)p.push(String.fromCharCode(o[n]));this.stream=p.join("")}function j(t,e,o,i,n){this.page=n,this.x1=t,this.y1=e,this.x2=o,this.y2=i,this.cols=["white","black"]}function O(t){this.width=t.width,this.height=t.height;for(var e=t.getContext("2d"),o=[this.width+" 0.0000 0.0000 -"+this.height+" 0.0000 "+this.height+" cm ","BI ","/Width "+this.width+" ","/Height "+this.height+" ","/ColorSpace /DeviceRGB ","/BitsPerComponent 8 ","ID\n"],i=e.getImageData(0,0,this.width,this.height),n=this.height-1;0<=n;n--)for(var r=0;r<this.width;r++){var s=i.data[4*(r+n*this.width)],a=i.data[4*(r+n*this.width)+1],h=i.data[4*(r+n*this.width)+2];o.push(String.fromCharCode(s)),o.push(String.fromCharCode(a)),o.push(String.fromCharCode(h))}o.push("\nEI\n"),this.stream=o.join("")}function F(){this.fontName="Helvetica",this.fontSize=12,this.italic=!1,this.bold=!1,this.font=void 0,this.alpha=1}function k(){}function D(t){this.str=t}f.PdfContext=function(t,e){var n=this,o=new v;this.doc=o;var i=document.createElement("canvas");this.context=i.getContext("2d"),o.pageSetWidth(t/72),o.pageSetHeight(e/72),o.addPage();var r="10px Helvetica";this.textAlign="left",this.textBaseline="alphabetic";Object.defineProperty(this,"fillStyle",{get:function(){return this.fillColor},set:function(t){if((this.fillColor=t)instanceof j)console.log("TODO",n.doc);else{var e=h(t);n.doc.fillColor(e.c,e.a)}}}),Object.defineProperty(this,"strokeStyle",{get:function(){return n.doc.strokeColor()},set:function(t){var e=h(t);n.doc.strokeColor(e.c,e.a)}}),Object.defineProperty(this,"lineWidth",{get:function(){return n.doc.setLineWidth()},set:function(t){n.doc.setLineWidth(t)}}),Object.defineProperty(this,"lineCap",{get:function(){return"butt"},set:function(t){n.doc.lineCap(t)}}),Object.defineProperty(this,"lineJoin",{get:function(){return"miter"},set:function(t){n.doc.lineJoin(t)}}),Object.defineProperty(this,"miterLimit",{get:function(){return 10},set:function(t){}}),Object.defineProperty(this,"globalAlpha",{get:function(){return n.doc.opacity()},set:function(t){n.doc.opacity(t)}}),Object.defineProperty(this,"font",{get:function(){return r},set:function(t){this.context.font=t,r=t;var e,o,i=((o=(e=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-,\'\"\sa-z]+?)\s*$/i).exec(n.font))||(console.log("error parsing font "+n.font),o=e.exec("10px Helvetica")),-1<o[6].indexOf("sans-serif")&&(o[6]="Helvetica"),-1<o[6].indexOf("serif")&&(o[6]="Times-Roman"),{style:o[1]||"normal",size:parseInt(o[4])||10,family:o[6]||"Helvetica",weight:o[3]||"normal"});n.doc.fontSize(i.size),n.doc.font(i.family),n.doc.setFontStyle("normal"!=i.weight,"normal"!=i.style,!1)}}),this.font=r,this.strokeStyle="rgb(0,0,0)",this.fillStyle="rgb(0,0,0)"},f.PdfContext.prototype.end=function(){this.doc.end()},f.PdfContext.prototype.addPage=function(){this.doc.addPage()},f.PdfContext.prototype.save=function(){this.doc.save()},f.PdfContext.prototype.restore=function(){this.doc.restore()},f.PdfContext.prototype.transform=function(t,e,o,i,n,r){this.doc.transform(t,e,o,i,n,r)},f.PdfContext.prototype.scale=function(t,e){this.doc.scale(t,e)},f.PdfContext.prototype.rotate=function(t){var e=180*t/Math.PI;this.doc.rotate(e)},f.PdfContext.prototype.translate=function(t,e){this.doc.translate(t,e)},f.PdfContext.prototype.beginPath=function(){this.doc.beginPath()},f.PdfContext.prototype.moveTo=function(t,e){this.doc.moveTo(t,e)},f.PdfContext.prototype.closePath=function(){this.doc.closePath()},f.PdfContext.prototype.lineTo=function(t,e){this.doc.lineTo(t,e)},f.PdfContext.prototype.stroke=function(){this.doc.stroke()},f.PdfContext.prototype.fill=function(t){this.doc.fill(t)},f.PdfContext.prototype.rect=function(t,e,o,i){this.doc.rect(t,e,o,i)},f.PdfContext.prototype.fillRect=function(t,e,o,i){this.doc.beginPath(),this.doc.rect(t,e,o,i),this.doc.fill()},f.PdfContext.prototype.strokeRect=function(t,e,o,i){this.doc.beginPath(),this.doc.rect(t,e,o,i),this.doc.stroke()},f.PdfContext.prototype.clearRect=function(t,e,o,i){var n=this.doc.fillColor();this.doc.fillColor("white"),this.doc.rect(t,e,o,i),this.doc.fill(),this.doc.fillColor(n)},f.PdfContext.prototype.arc=function(t,e,o,i,n,r){this.doc.arc(t,e,o,i,n,r)},f.PdfContext.prototype.bezierCurveTo=function(t,e,o,i,n,r){this.doc.bezierCurveTo(t,e,o,i,n,r)},f.PdfContext.prototype.quadraticCurveTo=function(t,e,o,i){this.doc.quadraticCurveTo(t,e,o,i)},f.PdfContext.prototype.createLinearGradient=function(t,e,o,i){return this.doc.linearGradient(t,e,o,i)},f.PdfContext.prototype.createRadialGradient=function(t,e,o,i,n,r){var s=this.doc.radialGradient(t,e,o,i,n,r);return s.addColorStop=function(t,e){var o=h(e);s.stop(t,o.c,o.a)},s},f.PdfContext.prototype.fillText=function(t,e,o){t&&t.trim().length&&this.doc.textAdd(e,o,t)},f.PdfContext.prototype.strokeText=function(t,e,o){console.log("strokeText not implemented, use fillText")},f.PdfContext.prototype.measureText=function(t){return this.context.measureText(t+"")},f.PdfContext.prototype.clip=function(){this.doc.clip()},f.PdfContext.prototype.getPDFbase64=function(){return this.doc.getBase64Text()},f.PdfContext.prototype.getPDFtext=function(){return this.doc.getText()},f.PdfContext.prototype.drawImage=function(t,e,o,i,n){return this.doc.drawImage(t,e,o,i,n)},f.PdfContext.prototype.setLineDash=function(t){return this.doc.setLineDash(t)},f.PdfContext.prototype.createPattern=function(t,e){this.doc.imageTileLoad(t)},f.PdfContext.prototype.setTransform=function(){console.log("setTransform not implemented")},f.PdfContext.prototype.drawFocusRing=function(){console.log("drawFocusRing not implemented")},f.PdfContext.prototype.createImageData=function(){console.log("drawFocusRing not implemented")},f.PdfContext.prototype.getImageData=function(){console.log("getImageData not implemented")},f.PdfContext.prototype.putImageData=function(){console.log("putImageData not implemented")},f.PdfContext.prototype.globalCompositeOperation=function(){console.log("globalCompositeOperation not implemented")},f.PdfContext.prototype.arcTo=function(t,e,o,i,n){console.log("arcTo not implemented")},v.prototype.add=function(t){return this.objects.push(t),t.id=this.objects.length,t},v.prototype.pageSetWidth=function(t){this.pageWidth=t},v.prototype.pageSetHeight=function(t){this.pageHeight=t},v.prototype.addPage=function(){this.currentPage=new S(this,this.pageWidth,this.pageHeight,this.pages.id),this.add(this.currentPage),this.pages.addPage(this.currentPage);var t=new w;this.add(t),this.currentPage.setStream(t)},v.prototype.font=function(t){this.currentPage.setFontName(t)},v.prototype.fontSize=function(t){this.currentPage.setFontSize(t)},v.prototype.lineJoin=function(t){this.currentPage.setLineJoin(t)},v.prototype.lineCap=function(t){this.currentPage.setLineCap(t)},v.prototype.setLineWidth=function(t){this.currentPage.setLineWidth(t)},v.prototype.strokeColor=function(t,e){this.currentPage.setStrokeColor(t,e)},v.prototype.fillColor=function(t,e){this.currentPage.setFillColor(t,e)},v.prototype.pageSetCurrent=function(t){this.currentPage=t},v.prototype.font=function(t){this.textStyle.setFontName(t)},v.prototype.fontSetSize=function(t){this.textStyle.fontSetSize(t)},v.prototype.setFontStyle=function(t,e){this.textStyle.setFontStyle(t,e)},v.prototype.fontSetColor=function(t,e,o){this.textStyle.setColor(new PDFColor(t,e,o))},v.prototype.setFont=function(t){var e=t.getFontName();if(null!=e){var o,i=null;for(o=0;o<this.fonts.length;o++)this.fonts[o].fontName==e&&(i=this.fonts[o]);null==i&&(i=new b(e),this.add(i),this.fonts.push(i)),t.setFont(i)}},v.prototype.textAdd=function(t,e,o){var i=this.textStyle.clone();this.setFont(i),this.currentPage.textAdd(t,e,o,i)},v.prototype.imageLoadFromCanvas=function(t){t=new I(t),this.add(t),this.currentImage=t},v.prototype.imageTileLoadFromCanvas=function(t){t=new O(t),this.add(t),this.currentPage.currentImageTile=t},v.prototype.linearGradient=function(t,e,o,i){var n=new j(t,e,o,i,this.currentPage);return this.add(n),this.currentPage.currentImageTile=n,this.addPatternToPage(n),n},v.prototype.doDrawImage=function(t,e,o,i){this.currentPage.drawImage(t,e,this.currentImage,this.alpha,o,i)},v.prototype.addPatternToPage=function(t){this.currentPage.addPatternToPage(t)},v.prototype.moveTo=function(t,e){this.currentPage.moveTo(t,e)},v.prototype.lineTo=function(t,e){this.currentPage.lineTo(t,e)},v.prototype.bezierCurveTo=function(t,e,o,i,n,r){this.currentPage.bezierCurveTo(t,e,o,i,n,r)},v.prototype.translate=function(t,e){this.currentPage.translate(t,e)},v.prototype.transform=function(t,e,o,i,n,r){this.currentPage.transform(t,e,o,i,n,r)},v.prototype.drawImage=function(t,e,o,i,n){if("img"==t.nodeName.toLowerCase()){var r=document.createElement("canvas");r.width=t.width,r.height=t.height,r.getContext("2d").drawImage(t,0,0),t=r}this.imageLoadFromCanvas(t),this.doDrawImage(e,o,t.width,t.height)},v.prototype.imageTileLoad=function(t){if("img"==t.nodeName.toLowerCase()){var e=document.createElement("canvas");e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0),t=e}this.imageTileLoadFromCanvas(t),this.addPatternToPage(this.currentPage.currentImageTile)},v.prototype.scale=function(t,e,o){this.currentPage.scale(t,e,o)},v.prototype.rotate=function(t,e){this.currentPage.rotate(t,e)},v.prototype.beginPath=function(){this.currentPage.beginPath()},v.prototype.arc=function(t,e,o,i,n,r){this.currentPage.arc(t,e,o,i,n,r)},v.prototype.closePath=function(){this.currentPage.closePath()},v.prototype.stroke=function(){this.currentPage.stroke()},v.prototype.clip=function(t){this.currentPage.clip(t)},v.prototype.opacity=function(t){this.currentPage.setAlpha(t)},v.prototype.setLineDash=function(t){this.currentPage.setLineDash(t)},v.prototype.save=function(){this.currentPage.saveContext()},v.prototype.restore=function(){this.currentPage.restoreContext()},v.prototype.fill=function(t){this.currentPage.fill(t)},v.prototype.rect=function(t,e,o,i){this.currentPage.rect(t,e,o,i)},v.prototype.quadraticCurveTo=function(t,e,o,i){this.currentPage.quadraticCurveTo(t,e,o,i)},v.prototype.graphicsSetAlpha=function(t){this.alpha=Math.floor(100*t/255)/100,this.textStyle.setAlpha(t)},v.prototype.graphicsSetLineEndType=function(t){this.lineEndType=t},v.prototype._write=function(t){this.stream+=t+"\n"},v.prototype.getObject=function(t){var e,o;for(this.stream="",this._write("%PDF-1.7"),e=0;e<this.objects.length;e++)(o=this.objects[e]).offset=this.stream.length,o=o.getObject(this,t),this._write(o);t=this.stream.length,this._write("xref"),this._write("0 "+(this.objects.length+1)),this._write("0000000000 65535 f");var i=this.objects;for(e=0;e<i.length;e++){var n=("0000000000"+(n=this.objects[e].offset)).slice(-10);this._write(n+" 00000 n")}return this._write("trailer"),this._write(p.convert({Size:this.objects.length+1,Root:new d(this.catalog.id+" 0 R")})),this._write("startxref"),this._write(t),this._write("%%EOF"),this.stream},v.prototype.getBase64Text=function(){return"data:application/pdf;base64,"+btoa(this.getObject(this))},n.prototype.setPages=function(t){this.props={Type:"Catalog",Pages:new d(t.id+" 0 R")}},n.prototype.getObject=function(t){return p.makeObject(this.props,this.id)},T.prototype.addPage=function(t){return this.pages.push(t),t.setPageNumber(this.pages.length),t},T.prototype.getObject=function(t){for(var e="[",o=0;o<this.pages.length;o++)e+=this.pages[o].id,e+=" 0 R ";e+="]";var i={Type:"Pages",Count:this.pages.length,Kids:new d(e)};return p.makeObject(i,this.id)},S.prototype.setStream=function(t){this.pdfStream=t,this.transform(1,0,0,-1,0,this.height)},S.prototype.setPageNumber=function(t){this.pageNumber=t},S.prototype.textAdd=function(t,e,o,i){var n=this.fontSize;-1==this.fonts.indexOf(i.font)&&this.fonts.push(i.font),o=p.convert(new String(o)),this.setAlpha(i.alpha),e=this.height-e,this.saveContext(),this.transform(1,0,0,-1,0,this.height),this.pdfStream.addText("BT "+this.strokeColor+" rg /F"+i.font.id+" "+n+" Tf 1 0 0 1 "+t+" "+e+" cm "+o+"Tj ET "),this.restoreContext()},S.prototype.setAlpha=function(t){if(t!=this.currentAlpha){-1==this.alphas.indexOf(t)&&this.alphas.push(t);var e=this.alphas.indexOf(t);this.pdfStream.addText("/Alpha"+e+" gs "),this.currentAlpha=t}},S.prototype.moveTo=function(t,e){this.pdfStream.addText(t+" "+e+" m ")},S.prototype.setLineWidth=function(t){this.lineWidth=t},S.prototype.lineTo=function(t,e){this.pdfStream.addText(t+" "+e+" l ")},S.prototype.bezierCurveTo=function(t,e,o,i,n,r){this.pdfStream.addText(t+" "+e+" "+o+" "+i+" "+n+" "+r+" c ")},S.prototype.transform=function(n,r,s,a,h,c){var t,e,o,i,p,f,d,l,u;e=(t=this._ctm)[0],o=t[1],i=t[2],p=t[3],f=t[4],d=t[5],t[0]=e*n+i*r,t[1]=o*n+p*r,t[2]=e*s+i*a,t[3]=o*s+p*a,t[4]=e*h+i*c+f,t[5]=o*h+p*c+d,u=function(){var t,e,o,i;for(i=[],t=0,e=(o=[n,r,s,a,h,c]).length;t<e;t++)l=o[t],i.push(+l.toFixed(5));return i}().join(" "),this.pdfStream.addText(u+" cm ")},S.prototype.translate=function(t,e){this.transform(1,0,0,1,t,e)},S.prototype.rotate=function(t,e){var o,i,n,r,s,a,h;null==e&&(e={}),i=t*Math.PI/180,o=Math.cos(i),n=Math.sin(i),r=s=0,null!=e.origin&&(a=(r=(h=e.origin)[0])*n+(s=h[1])*o,r-=r*o-s*n,s-=a),this.transform(o,n,-n,o,r,s)},S.prototype.scale=function(t,e,o){var i,n,r;null==e&&(e=t),null==o&&(o={}),i=n=0,null!=o.origin&&(i=(r=o.origin)[0],n=r[1],i-=t*i,n-=e*n),this.transform(t,0,0,e,i,n)},S.prototype.stroke=function(){this.pdfStream.addTextCheckMerge("S ")},S.prototype.clip=function(t){this.pdfStream.addText((/even-?odd/.test(t)?"W* ":"W ")+" n ")},S.prototype.setLineDash=function(t){this.lineDash=t},S.prototype.saveContext=function(){this.pdfStream.addText("q ")},S.prototype.restoreContext=function(){this.pdfStream.addText("Q ")},S.prototype.fill=function(t){this.currentImageTile&&(this.pdfStream.addText("/Pattern cs "),this.pdfStream.addText("/Pattern CS "),this.pdfStream.addText("/Paint"+this.currentImageTile.id+" scn "),this.pdfStream.addText("/Paint"+this.currentImageTile.id+" SCN "),this.currentImageTile=void 0),this.pdfStream.addTextCheckMerge(/even-?odd/.test(t)?"f* ":"f ")},S.prototype.beginPath=function(){if(this.lineDash){this.pdfStream.addText("[");for(var t=0;t<this.lineDash.length;t++)this.pdfStream.addText(this.lineDash[t]),this.pdfStream.addText(" ");this.pdfStream.addText("] 0 d ")}this.setAlpha(this.alpha),this.pdfStream.addText(this.fillColor+" rg "),this.pdfStream.addText(this.strokeColor+" RG "),this.pdfStream.addText(this.lineCap+" J "+this.lineJoin+" j "+(1|this.lineWidth)+" w ")},S.prototype.setStrokeColor=function(t,e){this.strokeColor=t||"0 0 0",this.alpha=e},S.prototype.setFillColor=function(t,e){this.fillColor=t||"0 0 0",this.alpha=e},S.prototype.closePath=function(){this.pdfStream.addText("h ")},S.prototype.quadraticCurveTo=function(t,e,o,i){return this.pdfStream.addText(t+" "+e+" "+o+" "+i+" v ")},S.prototype._bezierCurve=function(t,e,o,i,n,r){var s=Math.PI,a=o,h=i,c=Math.cos(n*s/180),p=Math.sin(n*s/180),f=Math.cos((n+r)*s/180),d=Math.sin((n+r)*s/180),l=t+a*c,u=e-h*p,g=-a*p,m=-h*c,y=t+a*f,C=e-h*d,P=-a*d,x=-h*f,v=Math.tan(r/2*s/180),T=Math.sin(r*s/180)*(Math.sqrt(4+3*v*v)-1)/3;Math.sqrt(g*g+m*m),Math.sqrt(P*P+x*x);return[l,u,l+T*g,u+T*m,y-T*P,C-T*x,y,C]},S.prototype.arc=function(t,e,o,i,n,r){i*=180/Math.PI,n*=180/Math.PI;for(var s=o-1,a=o-1,h=Math.ceil(Math.abs(n/45)),c=i,p=n/h,f=0;f<h;f++){var d=this._bezierCurve(t,e,s,a,c,p);0==f&&this.moveTo(d[0],d[1]),this.bezierCurveTo(d[2],d[3],d[4],d[5],d[6],d[7]),c+=p}},S.prototype.rect=function(t,e,o,i){var n=t+o,r=e+i;this.pdfStream.addText(t+" "+e+" m "+n+" "+e+" l "+n+" "+r+" l "+t+" "+r+" l "+t+" "+e+" l ")},S.prototype._CAP_STYLES={BUTT:0,ROUND:1,SQUARE:2},S.prototype.setLineCap=function(t){"string"==typeof t&&(t=this._CAP_STYLES[t.toUpperCase()]),this.lineCap=t},S.prototype._JOIN_STYLES={MITER:0,ROUND:1,BEVEL:2},S.prototype.setLineJoin=function(t){"string"==typeof t&&(t=this._JOIN_STYLES[t.toUpperCase()]),this.lineJoin=t},S.prototype.setFontSize=function(t){this.fontSize=t},S.prototype.transform=function(n,r,s,a,h,c){var t,e,o,i,p,f,d,l,u;e=(t=this._ctm)[0],o=t[1],i=t[2],p=t[3],f=t[4],d=t[5],t[0]=e*n+i*r,t[1]=o*n+p*r,t[2]=e*s+i*a,t[3]=o*s+p*a,t[4]=e*h+i*c+f,t[5]=o*h+p*c+d,u=function(){var t,e,o,i;for(i=[],t=0,e=(o=[n,r,s,a,h,c]).length;t<e;t++)l=o[t],i.push(+l.toFixed(5));return i}().join(" "),this.pdfStream.addText(u+" cm ")},S.prototype.drawImage=function(t,e,o,i,n,r){this.saveContext(),this.transform(1,0,0,-1,0,0),this.translate(t,-r-e),this.scale(n,r),this.pdfStream.addText("/Image"+o.id+" Do "),this.restoreContext(),-1==this.images.indexOf(o)&&this.images.push(o)},S.prototype.addPatternToPage=function(t){-1==this.fillImages.indexOf(t)&&this.fillImages.push(t)},S.prototype.getObject=function(t){t.pageSetCurrent(this);var e={Type:"Page"};e.Parent=new d(this.pagesID+" 0 R"),e.MediaBox=[0,0,this.width,this.height],e.Contents=new d(this.pdfStream.id+" 0 R");var o="<<";if(0<this.fonts.length)for(var i=0;i<this.fonts.length;i++){var n=this.fonts[i];o+="/F"+n.id+" "+n.id+" 0 R"}o+=">>";var r={};if(0<this.alphas.length)for(i=0;i<this.alphas.length;i++){var s=this.alphas[i];!isNaN(s)&&void 0!==s||(s="1"),"string"==typeof s&&(s=+s),r["Alpha"+i]={CA:s,ca:s}}var a="<<";if(0<this.images.length)for(var h=0;h<this.images.length;h++)a+="/Image"+(n=this.images[h]).id+" "+n.id+" 0 R";a+=">>";var c="<<";if(0<this.fillImages.length)for(h=0;h<this.fillImages.length;h++)c+="/Paint"+(n=this.fillImages[h]).id+" "+n.id+" 0 R";return c+=">>",e.Resources={},0<this.fonts.length&&(e.Resources.Font=new d(o)),0<this.alphas.length&&(e.Resources.ExtGState=r),0<this.fillImages.length&&(e.Resources.Pattern=new d(c)),0<this.images.length&&(e.Resources.XObject=new d(a)),p.makeObject(e,this.id)},b.TIMES=["Times-Roman","Times-Italic","Times-Bold","Times-BoldItalic"],b.HELVETICA=["Helvetica","Helvetica-Oblique","Helvetica-Bold","Helvetica-BoldOblique"],b.getPDFName=function(t,e,o){var i=(e?2:0)+(o?1:0);return"Helvetica"==t?b.HELVETICA[i]:b.TIMES[i]},b.prototype.getObject=function(t){var e={Subtype:"Type1",Name:"F"+this.id,BaseFont:this.fontName,Encoding:"WinAnsiEncoding",Type:"Font"};return p.makeObject(e,this.id)},w.prototype.addText=function(t){this.stream+=t},w.prototype.addTextCheckMerge=function(t){function e(t,e){return-1!==t.indexOf(e,t.length-e.length)}"f* "==t&&e(this.stream," S ")?this.stream=this.stream.substring(0,this.stream.length-3)+" B* ":"S "==t&&e(this.stream," f* ")?this.stream=this.stream.substring(0,this.stream.length-4)+" B* ":"f "==t&&e(this.stream," S ")||"S "==t&&e(this.stream," f ")?this.stream=this.stream.substring(0,this.stream.length-3)+" B ":this.stream+=t},w.prototype.replaceText=function(t,e){this.stream=this.stream.replace(t,e)},w.prototype.getObject=function(t){var e=this.stream;if(f.usePako){e=pako.deflate(e);for(var o=[],i=0;i<e.length;i++)o.push(String.fromCharCode(e[i]));e=o.join("")}var n={Length:e.length};return f.usePako&&(n.Filter="FlateDecode"),p.makeObject(n,this.id,e)},I.prototype.writeImage=function(t){this.stream=t},I.prototype.getObject=function(){var t={Type:"XObject",Width:this.width,Height:this.height,Subtype:"Image",ColorSpace:"DeviceRGB",BitsPerComponent:8,Name:"Image"+this.id,Length:this.stream.length};return f.usePako&&(t.Filter="FlateDecode"),p.makeObject(t,this.id,this.stream)},j.prototype.addColorStop=function(t,e){0!=t&&1!=t&&console.error("only 0 and 1 suppored for addColorStop",t),this.cols[Math.round(t)]=e},j.prototype.getObject=function(){var t=h(this.cols[0]).c.split(" "),e=h(this.cols[1]).c.split(" "),o={Type:"Pattern",PatternType:2,Shading:{ShadingType:2,Extend:[!0,!0],Coords:[this.x1,this.page.height-this.y1,this.x2,this.page.height-this.y2],ColorSpace:"DeviceRGB",Function:{FunctionType:2,N:1,Domain:[0,1],C0:[+t[0],+t[1],+t[2]],C1:[+e[0],+e[1],+e[2]]}}};return p.makeObject(o,this.id,this.stream)},O.prototype.writeImage=function(t){this.stream=t},O.prototype.getObject=function(){var t={Type:"Pattern",PatternType:1,PaintType:1,TilingType:1,BBox:[0,0,this.width,this.height],XStep:this.width,YStep:this.height,Length:this.stream.length,Resources:{ProcSet:["PDF","ImageC"]}};return p.makeObject(t,this.id,this.stream)},F.prototype.setFontName=function(t){this.fontName=t,this.font=void 0},F.prototype.fontSetSize=function(t){this.fontSize=t},F.prototype.setFontStyle=function(t,e){this.bold=t,this.italic=e},F.prototype.setColor=function(t){this.color=t},F.prototype.setAlpha=function(t){this.alpha=t},F.prototype.getFontName=function(){return b.getPDFName(this.fontName,this.bold,this.italic)},F.prototype.setFont=function(t){this.font=t},F.prototype.clone=function(){var t=new F;return t.fontName=this.fontName,t.fontSize=this.fontSize,t.bold=this.bold,t.italic=this.italic,t.color=this.color,t.alpha=this.alpha,t.font=this.font,t},g=function(t,e){return(Array(e+1).join("0")+t).slice(-e)},u=/[\n\r\t\b\f\(\)\\]/g,l={"\n":"\\n","\r":"\\r","\t":"\\t","\b":"\\b","\f":"\\f","\\":"\\\\","(":"\\(",")":"\\)"},k.makeObject=function(t,e,o){var i=e+" 0 obj\n"+k.convert(t);return o&&(i+="\nstream\n"+o+"\nendstream\n"),i+="endobj\n"},k.convert=function(i){var n,t,e,o,r,s,a,h,c;if("string"==typeof i)return"/"+i;if(i instanceof String){for(e=!1,t=h=0,c=(s=i.replace(u,function(t){return l[t]})).length;h<c;t=h+=1)if(127<s.charCodeAt(t)){e=!0;break}if(e){var p="";for(t=h=0,c=s.length;h<c;t=h+=1)s.charCodeAt(t)<=127?p+=s[t]:p+="?";s=p}return"("+s+")"}if(i instanceof d)return i.toString();if(i instanceof Date)return"(D:"+g(i.getUTCFullYear(),4)+g(i.getUTCMonth()+1,2)+g(i.getUTCDate(),2)+g(i.getUTCHours(),2)+g(i.getUTCMinutes(),2)+g(i.getUTCSeconds(),2)+"Z)";if(Array.isArray(i))return"["+function(){var t,e,o;for(o=[],t=0,e=i.length;t<e;t++)n=i[t],o.push(k.convert(n));return o}().join(" ")+"]";if("[object Object]"!=={}.toString.call(i))return""+i;for(o in r=["<<"],i)a=i[o],r.push("/"+o+" "+k.convert(a));return r.push(">>"),r.join("")+"\n"},p=k,D.prototype.toString=function(){return this.str},d=D}("undefined"!=typeof window?window:this);